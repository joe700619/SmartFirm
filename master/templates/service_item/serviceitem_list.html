{% extends 'base.html' %}

{% block title %}收費明細表 | SmartFirm{% endblock %}

{% block extra_css %}
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
<style>
    /* DataTables Hover Styling */
    table.dataTable.hover tbody tr:hover,
    table.dataTable.display tbody tr:hover {
        background-color: #f6f6f6;
    }
</style>
{% endblock %}

{% block page_header %}
收費明細管理
{% endblock %}

{% block content %}
<div class="row mb-3 align-items-center">
    <div class="col-md-6">
        <a href="{% url 'master:serviceitem_add' %}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> 新增收費項目
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table id="serviceItemTable" class="table table-hover align-middle">
                <thead class="table-light border-bottom border-2 fw-bold">
                    <tr>
                        <th width="40" class="text-center">
                            <input type="checkbox" id="selectAll" class="form-check-input">
                        </th>
                        <th>服務代碼</th>
                        <th>服務名稱</th>
                        <th>參考價格</th>
                        <th>部門</th>
                        <th>備註</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in service_items %}
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" name="item_ids" value="{{ item.pk }}"
                                class="form-check-input item-checkbox">
                        </td>
                        <td>{{ item.service_code }}</td>
                        <td>{{ item.service_name }}</td>
                        <td>{{ item.reference_price }}</td>
                        <td>{{ item.department|default:"-" }}</td>
                        <td>{{ item.remarks|default:"-"|truncatechars:30 }}</td>
                        <td>
                            <a href="{% url 'master:serviceitem_edit' item.pk %}"
                                class="btn btn-sm border-0 text-primary" title="編輯">
                                <i class="bi bi-pencil-fill"></i>
                            </a>
                            <a href="{% url 'master:serviceitem_delete' item.pk %}"
                                class="btn btn-sm border-0 text-danger" title="刪除">
                                <i class="bi bi-trash-fill"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- DataTables JS -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function () {
        // Initialize DataTables
        var table = $('#serviceItemTable').DataTable({
            "language": {
                "processing": "處理中...",
                "loadingRecords": "載入中...",
                "lengthMenu": "顯示 _MENU_ 項結果",
                "zeroRecords": "沒有符合的結果",
                "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                "infoFiltered": "(從 _MAX_ 項結果中過濾)",
                "infoPostFix": "",
                "search": "搜尋:",
                "paginate": {
                    "first": "第一頁",
                    "previous": "上一頁",
                    "next": "下一頁",
                    "last": "最後一頁"
                },
                "aria": {
                    "sortAscending": ": 升冪排列",
                    "sortDescending": ": 降冪排列"
                }
            },
            "order": [[1, "asc"]],
            "columnDefs": [
                { "orderable": false, "targets": [0, 6] }
            ],
            "pageLength": 25,
            "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                '<"row"<"col-sm-12"tr>>' +
                '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
        });

        $('#selectAll').on('click', function (e) {
            var rows = table.rows({ 'search': 'applied' }).nodes();
            $('input[type="checkbox"]', rows).prop('checked', this.checked);
        });

        $('#serviceItemTable tbody').on('change', 'input[type="checkbox"]', function () {
            if (!this.checked) {
                var el = $('#selectAll').get(0);
                if (el && el.checked && ('indeterminate' in el)) {
                    el.indeterminate = true;
                }
            }
        });
    });
</script>
{% endblock %}